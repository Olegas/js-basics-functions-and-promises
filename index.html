<!DOCTYPE html>
<html lang="en">
<head>
	<title>Shower Presentation Engine</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="node_modules/shower-material/styles/screen-16x10.css">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
	<style>
		.caption {
			background: #00679C;
		}
		.caption p {
			color: rgba(26, 185, 237, 1);
		}
		.slide .shout:after {
			background: none;
		}
		.slide h2 {
			color: #00679C;
			padding-left: 0;
		}
		.slide h2.shout {
			text-align: center;
			padding-left: 0;
			color: #00679C;
		}
		.slide code, .slide .mark {
			background: rgba(26, 185, 237, 0.3);
		}
		.progress {
			background: #00679C;
		}
	</style>
</head>
<body class="shower list">

	<header class="caption">
		<h1>JavaScript. Асинхронная обработка данных.</h1>
		<p>Елифантьев Олег, Тензор.</p>
	</header>

	<section class="slide" id="cover">
		<h2>JavaScript. Асинхронная обработка данных.</h2>
		<p>Елифантьев Олег, Тензор.</p>
		<figure>
			<img class="cover" src="pictures/cover.jpg" alt="Hands on the orange typewriter in a park">
			<figcaption class="white">
				<a href="http://fiftyfootshadows.net/">© John Carey</a>
			</figcaption>
		</figure>
		<style>
			#cover h2 {
				margin:30px 0 0;
				color:#FFF;
				text-align:center;
				font-size:70px;
				}
			#cover p {
				margin:10px 0 0;
				text-align:center;
				color:#FFF;
				font-style:italic;
				font-size:20px;
				}
			#cover p a {
				color:#FFF;
			}
		</style>
	</section>

	<section class="slide">
		<h2 class="shout">Асинхронные процессы на &laquo;птичках и рыбках&raquo;</h2>
	</section>

	<section class="slide">
		<h2>Асинхронная обработка данных</h2>
		<p>Все вы наверняка хоть раз бывали в ресторане.
			А если вдруг не бывали, то точно знаете как там все устроено из кино&hellip;</p>
	</section>

	<section class="slide">
		<h2>Официант принимает заказ</h2>
		<pre class="next"><code class="javascript">_getOrder: function(client) {
	var item, order = [];
	while(item = client.waitForOrderItem()) {
		order.push(item);
	}
	this.say('Скоро все будет готово!');
	return order;
}</code></pre>
	</section>

	<section class="slide">
		<h2>Официант принимает заказ</h2>
		<pre><code class="javascript">_getOrder: function(client) {
	var item, order = [];
	while(<mark>item = client.waitForOrderItem()</mark>) {
		order.push(item);
	}
	this.say('Скоро все будет готово!');
	return order;
}</code></pre>
	</section>

	<section class="slide">
		<h2>Когда заказ принят&hellip;</h2>
		<pre class="next"><code class="javascript">pleaseTakeMyOrder: function(client) {
	var order = this._getOrder(client);
	return this._getOrderDone(order); // Magic!
}

Waiter.pleaseTakeMyOrder(me); // ???
		</code></pre>
	</section>

	<section class="slide">
		<h2>Когда заказ принят&hellip;</h2>
		<pre><code class="javascript">pleaseTakeMyOrder: function(client) {
	var order = this._getOrder(client);
	return this._getOrderDone(order); // -> Promise, Deferred
}

Waiter.pleaseTakeMyOrder(me); // -> Promise, Deferred
		</code></pre>
	</section>

	<section class="slide">
		<h2>Когда заказ готов&hellip;</h2>
		<pre><code class="javascript">Waiter.pleaseTakeMyOrder(me).addCallback(function(dishes) {
	me.eat(dishes);
});
		</code></pre>
	</section>

	<section class="slide">
		<h2>А если заказ не приготовили?</h2>
		<pre class="next"><code class="javascript">Waiter.pleaseTakeMyOrder(me)
	.addCallback(function(dishes) {
		me.eat(dishes);
	})
	.addErrback(function(regrets) {
		me.sad();
	});
		</code></pre>
	</section>

	<section class="slide">
		<h2>А что внутри у официанта?</h2>
		<pre class="next"><code class="javascript">pleaseTakeMyOrder: function(client) {
	var order = this._getOrder(client);
	return this._getOrderDone(order);
},<span class="next">
getOrderDone: function(order) {
	return Kitchen.cook(order);
}</span></code></pre>
	</section>


	<section class="slide">
		<h2>А что на кухне</h2>
		<pre class="next"><code class="javascript">cook: function(order) {
	// дождаться пока появится свободный повар
	// отдать ему заказ для приготовления
}</code></pre>
	</section>

	<section class="slide">
		<h2>А что на кухне</h2>
		<pre><code class="javascript">cook: function(order) {
	var cook = this.waitForFreeCook();
	var dishes = cook.makeFood(order);
	return dishes;
}</code></pre>
	</section>

	<section class="slide">
		<h2>А что на кухне</h2>
		<pre><code class="javascript">cook: function(order) {
	return this.waitForFreeCook()
		.addCallback(function(cook) {
			return cook.makeFood(order);
		});
}</code></pre>
	</section>

	<section class="slide">
		<h2>А что на кухне</h2>
		<pre><code class="javascript">cook: function(order) {
	return this.waitForFreeCook()
		<mark>.addCallback(function(cook) {</mark>
			<mark>return cook.makeFood(order);</mark>
		<mark>})</mark>
}</code></pre>
	</section>

	<section class="slide">
		<h2>И тут ВНЕЗАПНО&hellip;</h2>
		<pre class="next"><code class="javascript">Waiter.pleaseTakeMyOrder(me)
	// .addCallback(...
	.addErrback(function(regrets) {
		<span class="next">// regrets == 'Колян! У нас духовка взорвалась!</span>
		me.sad();
	});
		</code></pre>
	</section>

	<section class="slide">
		<h2>И тут ВНЕЗАПНО&hellip;</h2>
		<pre><code class="javascript">Waiter.pleaseTakeMyOrder(me)
	// .addCallback(...
	.addErrback(function(regrets) {
		<span>// regrets == 'Колян! У нас духовка взорвалась!</span>
		me.angry();
		me.getOut();
	});
		</code></pre>
	</section>

	<section class="slide">
		<h2>Как ведет себя правильный официант</h2>
		<pre class="next"><code class="javascript">_getOrderDone: function(order) {
	return Kitchen
		.cook(order)
		.addErrback(function(badThingsHappens) {
			return new Error('К сожалению, ...');
		})
}</code></pre>
	</section>

	<section class="slide">
		<h2>И тут ВНЕЗАПНО&hellip;</h2>
		<pre><code class="javascript">Waiter.pleaseTakeMyOrder(me)
	// .addCallback(...
	.addErrback(function(regrets) {
		<span>// regrets == 'К сожалению, ...</span>
		me.tryChangeOrder();
	});
		</code></pre>
	</section>

	<section class="slide">
		<h2>Что если заказ не только с кухни?</h2>
		<pre class="next"><code class="javascript">_getOrderDone: function(order) {
	var toKitchen = onlyToKitchen(order),
		toBar = onlyToBar(order);
	<span class="next">
	Kitchen.cook(toKitchen).addCallback(function (dishes) {
		Bar.get(toBar).addCallback(function (wine) {
			// result is ...
		})
	});</span></code></pre>
	</section>

	<section class="slide">
		<h2>Хороший официант так не поступит!</h2>
		<pre class="next"><code class="javascript">return new ParallelDeferred({
	steps: [
		Kitchen.cook(fromKitchen),
		Bar.get(fromBar)
	]
}).done().getResult().addErrback(function(badThingsHappens) {
	return new Error('К сожалению, ...');
})</code></pre>
	</section>

	<section class="slide">
		<h2 class="shout">Асинхронность в JavaScript</h2>
	</section>

	<section class="slide">
		<h2>Асинхронность в JavaScript</h2>
		<ul>
			<li class="next">Таймер (setTimeout)</li>
			<li class="next">Операции с сетью
				<ul>
					<li class="next">Подгрузка модулей</li>
					<li class="next">Выполнение методов бэкэнда</li>
					<li class="next">Загрузка стилей (CSS) и картинок (&lt;img /&gt;)</li>
					<li class="next">Можество других API, работающих с &laquo;внешними&raquo; данными</li>
				</ul>
			</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Как с этим жить?</h2>
		<pre><code class="javascript">
doAsync(args, cbResult, cbError);
doAsync(args, cbDone /* function(err, result) */)
// and counting...
		</code></pre>
	</section>

	<section class="slide">
		<h2>Callback Hell</h2>
		<pre class="next"><code class="javascript">doAsyncOne(args, function(err, result) {
	if (! err) {
		doAsyncTwo(result, function(err, result2) {
			// ... и так далее до бесконечности
		});
	} else {
		// handle it
	}
}</code></pre>
	</section>

	<section class="slide">
		<h2>Promise / Deferred</h2>
		<pre><code class="javascript">
<strike>doAsync(args, cbResult, cbError);</strike>
<strike>doAsync(args, cbDone /* function(err, result) */)</strike>

doAsync(args) // -> Promise/Deferred
		</code></pre>
	</section>

	<section class="slide">
		<h2 class="shout">Для кругозора</h2>
	</section>

	<section class="slide">
		<h2>Promise <-> Deferred ????</h2>
		<ul>
			<li class="next">.addCallback - .then</li>
			<li class="next">.addErrback - .catch</li>
			<li class="next">ParallelDeferred - Promise.all([...]) -> Promise</li>
		</ul>
	</section>

	<section class="slide">
		<h2 class="shout">
			<img src="pictures/sbis-bird.png" alt="" width="30%"><br />
			Вопросы есть?</h2>
	</section>

	<section class="slide">
		<h2 class="shout">
			<img src="pictures/sbis-cloud.png" alt="" width="30%"><br />
			Спасибо за внимание.</h2>
	</section>

	<footer class="badge">
		<a href="https://github.com/olegas/js-basic-1">Fork me on GitHub</a>
	</footer>

	<div class="progress"></div>

	<script src="node_modules/shower-core/shower.min.js"></script>
	<!-- Copyright © 2017 Yours Truly, Famous Inc. -->

	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
